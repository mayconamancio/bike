function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){var n;if(e)return"string"==typeof e?_arrayLikeToArray(e,t):"Map"===(n="Object"===(n=Object.prototype.toString.call(e).slice(8,-1))&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,a,c=[],s=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;s=!1}else for(;!(s=(r=i.call(n)).done)&&(c.push(r.value),c.length!==t);s=!0);}catch(e){u=!0,o=e}finally{try{if(!s&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw o}}return c}}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,_toPropertyKey(r.key),r)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){e=_toPrimitive(e,"string");return"symbol"===_typeof(e)?e:String(e)}function _toPrimitive(e,t){if("object"!==_typeof(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0===n)return("string"===t?String:Number)(e);n=n.call(e,t||"default");if("object"!==_typeof(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}!function(){"use strict";var n=function(){function n(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).filterTag,t=void 0===t?"":t;_classCallCheck(this,n),this.callback=function(){},this.observedDataProperty=e,this.filterTag=t,this.startObservation()}return _createClass(n,[{key:"subscribe",value:function(e){this.callback=e;e=this.findMatchingElements(document.body);this.sendElementsToCallback(e)}},{key:"disconnect",value:function(){this.observer.disconnect()}},{key:"handleMutation",value:function(e){var o=this;e.forEach(function(e){for(var e=e.addedNodes,t=0,n=Array.from(e);t<n.length;t++){var r=n[t];if(!(r instanceof HTMLElement))return;r=o.findMatchingElements(r);o.sendElementsToCallback(r)}})}},{key:"findMatchingElements",value:function(e){var t="".concat(this.filterTag,"[").concat(this.observedDataProperty,"]");return e.querySelectorAll(t)}},{key:"sendElementsToCallback",value:function(e){var t=this;Array.from(e).forEach(function(e){return t.callback(e)})}},{key:"startObservation",value:function(){this.observer=new MutationObserver(this.handleMutation.bind(this));this.observer.observe(document.body,{childList:!0,subtree:!0,characterData:!1,attributes:!1})}}]),n}();var t=2;function r(e){e=new RegExp("(^| )".concat(e,"=([^;]+)")),e=document.cookie.match(e);if(e)return decodeURI(e[t])}function o(e,t,n){var t=encodeURI(t),r=window.location.hostname,o=new Date,n=(o.setTime(o.getTime()+n),o.toUTCString());document.cookie="".concat(e,"=").concat(t,"; expires=").concat(n,"; path=/; domain=").concat(r)}var i="VtexRCSessionIdv7",a="VtexRCMacIdv7",c="VtexWorkspace";function s(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function u(){var e=r(i),t=null!=e?e:s();return o(i,t,18e5),{sessionID:t,isNewSessionID:!e}}function l(){var e=r(a),t=null!=e?e:s();return o(a,t,31536e6),{macID:t,isNewUser:!e}}function d(){return Object.assign(Object.assign(Object.assign({},u()),l()),{accountName:f(),url:v(),ref:window.document.referrer,workspace:null!=(e=null!=(e=function(){var e=r(c);return _slicedToArray(null!=(e=null==e?void 0:e.split(":"))?e:[],1)[0]}())?e:function(){var e=new RegExp(/[?&]workspace=([^&]+)(&|$)/).exec(window.location.search);return null==e?void 0:e[1]}())?e:function(){var e;return null==(e=null===window||void 0===window?void 0:window.__RUNTIME__)?void 0:e.workspace}()});var e}function f(){var e;return null!=(e=null!=(e=null==(e=window.__RUNTIME__)?void 0:e.account)?e:window.jsnomeLoja)?e:null==(e=window.VTEX_METADATA)?void 0:e.account}function v(){return window.location.href}var e="https://af-origin.vtex.com/api/activity-flow",p="Event",y=1e4,m={pageView:"".concat(e,"/page-views"),performanceTiming:"".concat(e,"/performance-timing"),orderForm:"".concat(e,"/order-form"),ads:"".concat(e,"/ads")};function w(e,t){var n,r;navigator.sendBeacon?navigator.sendBeacon(t,e):(n=t,r=e,new Promise(function(e){var t=new XMLHttpRequest;t.timeout=y,t.open("POST",n,!0),t.setRequestHeader("Content-Type","application/json"),t.send(r),t.onload=function(){if(200===t.status||202===t.status)return u(),e(r)}}))}function b(e){var t={SessionId:(t=d()).sessionID,MacId:t.macID,IsNewUser:t.isNewUser,Url:t.url,Ref:t.ref,accountName:t.accountName,clientdate:(new Date).getTime(),isFirstEvent:t.isNewSessionID,workspace:t.workspace},n=t.IsNewUser,r=t.isFirstEvent,t=function(e,t){var n={};for(o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(n[o[r]]=e[o[r]]);return n}(t,["IsNewUser","isFirstEvent"]),t=Object.assign(Object.assign(Object.assign({},e),{DataType:p}),t),t="pageView"===e.eventType?Object.assign(Object.assign({},t),{IsNewUser:n,isFirstEvent:r}):t;return JSON.stringify(t)}function h(e){null!=e.eventType&&w(b(e),m[e.eventType])}var g=["biggy","storecomponents","extrafarmav2","lebiscuit","casaevideonewio","paguemenos","amobeleza"];var T={adId:"van-aid",campaignId:"van-cid",productId:"van-prod-id",productName:"van-prod-name",adRequestId:"van-req-id",adResponseId:"van-res-id",actionCost:"van-cpc",position:"van-position"};function k(e){e=function(e){for(var t={},n=Object.keys(T),r=0,o=n;r<o.length;r++){var i=o[r],a=T[i],a=null!=(a=e.getAttribute("data-".concat(a)))?a:"";t[i]=a}return t}(e);return Object.assign(Object.assign({},e),{actionCost:Number(e.actionCost),position:Number(e.position)})}var x=function(){function e(){_classCallCheck(this,e),this.impressionedAds={},this.clickTimestamps={}}return _createClass(e,[{key:"track",value:function(e){var t=k(e);this.trackImpression(t),this.trackClicks(e,t)}},{key:"trackImpression",value:function(e){var t=this.getCacheKey(e);this.impressionedAds[t]||(this.impressionedAds[t]=!0,this.sendAdEvent(e,"impression"))}},{key:"trackClicks",value:function(e,o){var i=this;e.addEventListener("click",function(){var e,t=i.getCacheKey(o),n=i.clickTimestamps[t],r=(r=n,e=6e4,performance.now()-r<=e);!!n&&r||(i.clickTimestamps[t]=performance.now(),i.sendAdEvent(o,"click"))})}},{key:"sendAdEvent",value:function(e,t){h(Object.assign(Object.assign({},e),{actionType:t,eventType:"ads"}))}},{key:"getCacheKey",value:function(e){return"".concat(e.adId,"-").concat(e.adRequestId)}}]),e}();function I(){var e,t;(e=f())&&g.includes(e)&&(e="data-".concat(T.adId),e=new n(e,{filterTag:"div"}),t=new x,e.subscribe(function(e){return t.track(e)}))}function _(i,a){var c=window.history[i];return function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=c.apply(this,t),o=new Event(i.toLowerCase());return a(),o.arguments=t,window.dispatchEvent(o),r}}var E="";function O(){var e;e=S,window.history?(window.history.pushState=_("pushState",e),window.history.replaceState=_("replaceState",e),window.addEventListener("popstate",function(){return e()}),window.addEventListener("hashchange",function(){return e()})):setInterval(function(){return e()},1e3),e()}function S(){var e=v();E!==e&&(E=e,h({eventType:"pageView"}))}function A(){var e;Math.random()<=.01&&(e=j,"complete"===document.readyState?e():window.attachEvent?window.attachEvent("onload",e):window.addEventListener("load",e,!1))}function j(){var e;e=function(){var e=function(){var e=performance.timing,t=performance.getEntriesByType("navigation")[0];t=t?{pageLoadTime:t.duration,timeToFirstByte:t.responseStart-t.startTime,collectedWithDeprecatedTimingAPI:!1}:{pageLoadTime:e.loadEventEnd-e.navigationStart,timeToFirstByte:e.responseStart-e.navigationStart,collectedWithDeprecatedTimingAPI:!0};return t}();h(Object.assign({eventType:"performanceTiming"},e))},"requestIdleCallback"in window?window.requestIdleCallback(e):setTimeout(e,1)}O(),A(),I()}();
//# sourceMappingURL=af.js.map
